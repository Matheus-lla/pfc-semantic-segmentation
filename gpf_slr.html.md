# Ground Plane Fitting and Scan Line Run for 3D LiDAR


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

# Imports

# Ground Plane Fitting (GPF)

------------------------------------------------------------------------

<a
href="https://github.com/Matheus-lla/pfc-semantic-segmentation/blob/main/pfc_packages/gpf_slr.py#L12"
target="_blank" style="float:right; font-size:smaller">source</a>

### extract_initial_seed_indices

>  extract_initial_seed_indices (point_cloud:numpy.ndarray,
>                                    num_points:int=1000,
>                                    height_threshold:float=0.4)

\*Extract initial seed points for ground plane estimation (GPF).

Args: point_cloud (np.ndarray): N x 3 array of points (x, y, z).
num_points (int): number of lowest Z points to average as LPR.
height_threshold (float): threshold to select seeds close to LPR height.

Returns: seeds_ids (np.ndarray): indices of points selected as initial
seeds.\*

------------------------------------------------------------------------

<a
href="https://github.com/Matheus-lla/pfc-semantic-segmentation/blob/main/pfc_packages/gpf_slr.py#L39"
target="_blank" style="float:right; font-size:smaller">source</a>

### estimate_ground_plane

>  estimate_ground_plane (points:numpy.ndarray)

\*Estimate the ground plane parameters using Singular Value
Decomposition (SVD).

Args: points (np.ndarray): N x 3 array (x, y, z) of seed points assumed
to be on or near the ground.

Returns: tuple: - normal (np.ndarray): Normal vector (a, b, c) of the
estimated ground plane. - d (float): Offset term of the estimated plane
equation (ax + by + cz + d = 0).\*

------------------------------------------------------------------------

<a
href="https://github.com/Matheus-lla/pfc-semantic-segmentation/blob/main/pfc_packages/gpf_slr.py#L71"
target="_blank" style="float:right; font-size:smaller">source</a>

### refine_ground_plane

>  refine_ground_plane (point_cloud:numpy.ndarray, num_points:int=1000,
>                           height_threshold:float=0.4,
>                           distance_threshold:float=0.2, num_iterations:int=5)

\*Iteratively refine the ground plane estimation using seed points and
distance threshold.

Args: point_cloud (np.ndarray): Nx6 array \[x, y, z, true_label,
pred_label, scanline_id\]. num_points (int): Number of lowest Z points
used to compute the initial ground seed height (LPR). height_threshold
(float): Vertical distance threshold from the LPR used to select initial
seed points. distance_threshold (float): Max allowed point-to-plane
distance for a point to be considered ground. num_iterations (int):
Number of iterations to refine the plane and ground classification.

Returns: tuple: - point_cloud (np.ndarray): Nx6 array \[x, y, z,
true_label, pred_label, scanline_id\], input array with ground points
labeled. - normal (np.ndarray): Normal vector (a, b, c) of the estimated
ground plane. - d (float): Offset term of the estimated plane equation
(ax + by + cz + d = 0).\*

# Scan Line Run (SLR)

------------------------------------------------------------------------

<a
href="https://github.com/Matheus-lla/pfc-semantic-segmentation/blob/main/pfc_packages/gpf_slr.py#L120"
target="_blank" style="float:right; font-size:smaller">source</a>

### group_by_scanline

>  group_by_scanline (point_cloud:numpy.ndarray)

\*Group points by their scanline index in a vectorized way.

Args: point_cloud (np.ndarray): N x 6 array \[x, y, z, true_label,
pred_label, scanline_id\].

Returns: list\[np.ndarray\]: List of arrays. Each array contains the
points (N_i x 6) from one scanline, sorted by scanline_id.\*

------------------------------------------------------------------------

<a
href="https://github.com/Matheus-lla/pfc-semantic-segmentation/blob/main/pfc_packages/gpf_slr.py#L137"
target="_blank" style="float:right; font-size:smaller">source</a>

### find_runs

>  find_runs (scanline_points:numpy.ndarray, distance_threshold:float=0.5)

\*Identify runs within a single scanline based on distance between
consecutive points.

Args: scanline_points (np.ndarray): N x 6 array \[x, y, z, true_label,
pred_label, scanline_id\]. distance_threshold (float): Distance
threshold to consider two points part of the same run.

Returns: list\[np.ndarray\]: List of arrays where each array contains
the points of a run.\*

------------------------------------------------------------------------

<a
href="https://github.com/Matheus-lla/pfc-semantic-segmentation/blob/main/pfc_packages/gpf_slr.py#L178"
target="_blank" style="float:right; font-size:smaller">source</a>

### update_labels

>  update_labels (runs_current:list[numpy.ndarray],
>                     runs_above:list[numpy.ndarray], label_equivalences:dict,
>                     merge_threshold:float=1.0)

\*Update labels of current scanline runs based on proximity to runs from
previous scanline using KDTree.

Args: runs_current (list\[np.ndarray\]): List of N x 6 arrays for
current scanline runs. runs_above (list\[np.ndarray\]): List of N x 6
arrays for previous scanline runs. label_equivalences (dict): Dictionary
of label equivalences. merge_threshold (float): Maximum distance to
consider connection between runs.\*

------------------------------------------------------------------------

<a
href="https://github.com/Matheus-lla/pfc-semantic-segmentation/blob/main/pfc_packages/gpf_slr.py#L236"
target="_blank" style="float:right; font-size:smaller">source</a>

### extract_clusters

>  extract_clusters (scanlines:list[numpy.ndarray], label_equivalences:dict)

\*Apply resolved labels to all points and return a unified point cloud.

Args: scanlines (list\[np.ndarray\]): List of N x 6 arrays for each
scanline. label_equivalences (dict): Dictionary of final label
equivalences.

Returns: np.ndarray: N x 6 array with updated labels in column 4.\*

------------------------------------------------------------------------

<a
href="https://github.com/Matheus-lla/pfc-semantic-segmentation/blob/main/pfc_packages/gpf_slr.py#L257"
target="_blank" style="float:right; font-size:smaller">source</a>

### scan_line_run_clustering

>  scan_line_run_clustering (point_cloud:numpy.ndarray,
>                                distance_threshold:float=0.5,
>                                merge_threshold:float=1.0)

\*Perform scan line run clustering on non-ground points (predicted_label
== 0).

This function detects connected components (runs) within scanlines,
propagates and merges labels across scanlines, and assigns final labels
to each point.

Args: point_cloud (np.ndarray): N x 6 array \[x, y, z, true_label,
predicted_label, scanline_index\]. distance_threshold (float): Distance
threshold to consider two points part of the same run. merge_threshold
(float): Maximum distance to consider connection between runs.

Returns: np.ndarray: Point cloud with updated predicted labels (column
4).\*
